<%- include('../layouts/header.ejs') %>


<style>
  .text-danger.visible {
    display: inline !important;
  }
</style>



<!--start product details-->
<section class="section-padding mt-5">
    <div class="container">
      <div class="d-flex align-items-center px-3 py-2 border mb-4">
        <div class="text-start">
          <h4 class="mb-0 h4 fw-bold">My Bag  items</h4>
       </div>
       <div class="ms-auto">
        <a href="/">
          <button type="button" class="btn btn-light btn-ecomm">Continue Shopping</button>
        </a>
      </div>
      
      </div>
	   <div class="row g-4">
      <% if (cartDetails.length > 0) { %>
	     <div class="col-12 col-xl-8">

        <% for (const product of cartDetails) { %>
		    <div class="card rounded-0 mb-3">
			  <div class="card-body">

        
          
			    <div class="d-flex flex-column flex-lg-row gap-3">
				   <div class="product-img">
				      <img src="/ProductImages/<%= product.productDetails.images[0] %>" width="150" alt="">
				   </div>
				    <div class="product-info flex-grow-1">
				      <h5 class="fw-bold mb-0"><%= product.productDetails.name %></h5>
					    <div class="product-price d-flex align-items-center gap-2 mt-3">
                <div class="h6 fw-bold"></div>
                <div class="h6 fw-light text-muted text-decoration-line-through"></div>
                
                  ₹<%= product.items.price %>
               
              </div>
					  	 <div class="mt-3 hstack gap-2">
                 <button type="button" class="btn btn-sm btn-light border rounded-0" data-bs-toggle="modal" data-bs-target="#SizeModal">Size : M</button>
                 


          
                 <% if (product.productDetails.countInStock > 0) { %>
                  <!-- Display the quantity as zero if countInStock is zero -->
                  <button class="btn btn-sm btn-light border rounded-0 btn-quantity" data-product-id="<%= product.productDetails._id %>" data-adjustment="-1">-</button>
                  <span id="quantity_<%= product.productDetails._id %>"><%= Math.max(0, product.items.quantity) %></span>
                  <button class="btn btn-sm btn-light border rounded-0 btn-quantity" data-product-id="<%= product.productDetails._id %>" data-adjustment="1">+</button>
                <% } 
                
    
                else { %>
                  <span id="quantity_<%= product.productDetails._id %>">0</span>
                <% } %>

                <% if(product.productDetails.countInStock !== 0 && product.items.quantity >= product.productDetails.countInStock){ %>
                  <small class="text-danger ">Limit reached</small>
                    <% } %>
                

                 
                


						</div>
				   </div>
           <div class="d-none d-lg-block vr"></div>
           <div class="d-grid gap-2 align-self-start align-self-lg-center">
             


     
            <form action="/deleteCart/<%= product.productDetails._id %>" method="post" id="removeProductForm">
              <button type="submit" class="btn btn-ecomm remove-product-btn">
                <i class="bi bi-x-lg me-2"></i>Remove
              </button>
            </form>
             




              <button type="button" class="btn dark btn-ecomm"><i class="bi bi-suit-heart me-2"></i>Move to Wishlist</button>
           </div>
			  	</div>

         
        

			  </div>
			</div> 



  

      <% } %>
		 </div>
		 <div class="col-12 col-xl-4">
		     <div class="card rounded-0 mb-3">
           <div class="card-body">
             <h5 class="fw-bold mb-4">Order Summary</h5>
             
             <hr>
             
        


             
            <div class="hstack align-items-center justify-content-between fw-bold text-content">
              <p class="mb-0">Total Amount</p>
             
              <p id="totalAmount" class="mb-0">₹<%= cartDetails[0].totalPrice %></p>
              
            </div>
           
            
            
            


         
            <div class="d-grid mt-4">
              <a href="/checkout" class="btn btn-dark btn-ecomm py-3 px-5">Place Order</a>
          </div>

    

          
          
           </div>
         </div>



         <!-- below coupon card -->

         
      


		 </div>


	 </div><!--end row-->

   <% } else { %>
    <div class="text-center">
        <p>Your cart is empty.</p>
    </div>
<% } %>
       
    </div>
  </section>
   <!--start product details-->


  
  
 </div>
  <!--end page content-->


  <!--start footer-->
  <section class="footer-section bg-section-2 section-padding">
    <div class="container">
       <div class="row row-cols-1 row-cols-lg-4 g-4">
        <div class="col">
          <div class="footer-widget-6">
            <img src="/images/logo.webp" class="logo-img mb-3" alt="">
            <h5 class="mb-3 fw-bold">About Us</h5>
             <p class="mb-2">There are many variations of passages of Lorem Ipsum available, but the majority have suffered alteration in some form, by injected humour, or randomised words which don't look even slightly believable.</p>

             <a class="link-dark" href="javascript:;">Read More</a>
          </div>
        </div>
        <div class="col">
          <div class="footer-widget-7">
            <h5 class="mb-3 fw-bold">Explore</h5>
             <ul class="widget-link list-unstyled">
               <li><a href="javascript:;">Fashion</a></li>
               <li><a href="javascript:;">Women</a></li>
               <li><a href="javascript:;">Furniture</a></li>
               <li><a href="javascript:;">Shoes</a></li>
               <li><a href="javascript:;">Topwear</a></li>
               <li><a href="javascript:;">Brands</a></li>
               <li><a href="javascript:;">Kids</a></li>
             </ul>
          </div>
        </div>
        <div class="col">
          <div class="footer-widget-8">
            <h5 class="mb-3 fw-bold">Company</h5>
             <ul class="widget-link list-unstyled">
               <li><a href="javascript:;">About Us</a></li>
               <li><a href="javascript:;">Contact Us</a></li>
               <li><a href="javascript:;">FAQ</a></li>
               <li><a href="javascript:;">Privacy</a></li>
               <li><a href="javascript:;">Terms</a></li>
               <li><a href="javascript:;">Complaints</a></li>
             </ul>
          </div>
        </div>
        <div class="col">
          <div class="footer-widget-9">
            <h5 class="mb-3 fw-bold">Follow Us</h5>
             <div class="social-link d-flex align-items-center gap-2">
               <a href="javascript:;"><i class="bi bi-facebook"></i></a>
               <a href="javascript:;"><i class="bi bi-twitter"></i></a>
               <a href="javascript:;"><i class="bi bi-linkedin"></i></a>
               <a href="javascript:;"><i class="bi bi-youtube"></i></a>
               <a href="javascript:;"><i class="bi bi-instagram"></i></a>
             </div>
             <div class="mb-4 mt-4">
              <h5 class="mb-0 fw-bold">Support</h5>
              <p class="mb-0 text-muted">support@example.com</p>
             </div>
             <div class="">
              <h5 class="mb-0 fw-bold">Toll Free</h5>
              <p class="mb-0 text-muted">1800- 8xx 2xx</p>
             </div>
          </div>
        </div>
       </div><!--end row-->
       <div class="my-5"></div>
       <div class="row">
         <div class="col-12">
           <div class="text-center">
            <h5 class="fw-bold mb-3">Download Mobile App</h5>
           </div>
          <div class="app-icon d-flex flex-column flex-sm-row align-items-center justify-content-center gap-2">
            <div>
              <a href="javascript:;">
                <img src="/images/play-store.webp" width="160" alt="">
              </a>
            </div>
            <div>
              <a href="javascript:;">
                <img src="/images/apple-store.webp" width="160" alt="">
              </a>
            </div>
          </div>
         </div>
       </div><!--end row-->

    </div>
  </section>
  <!--end footer-->







  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

  <script>
  $(document).ready(function () {
    // The script listens for a click event on elements with the class btn-quantity and calls updateQuantity function
    $(document).on('click', '.btn-quantity', function () {
      // uses jQuery to extract the productId and adjustment values from the button's data attributes.
      var productId = $(this).data('product-id');
      var adjustment = parseInt($(this).data('adjustment'));

      updateQuantity(productId, adjustment);
    });

    function updateQuantity(productId, adjustment) {
      $.ajax({
        url: '/updateQuantity',
        method: 'POST',
        data: { productId, adjustment },
        success: (response) => {
          if (response.userCart) {
            // Update the quantity on the page
            var quantityElement = $(`#quantity_${productId}`);
            quantityElement.text(response.userCart.items.find(item => String(item.product_id) === productId).quantity);

            // Update the total amount on the page
            $('#totalAmount').text('₹' + response.totalAmount);

            // Check if the new quantity has reached the limit
            var limitReachedMessage = quantityElement.siblings('.text-danger');
            var newQuantity = response.userCart.items.find(item => String(item.product_id) === productId).quantity;
            
            if (newQuantity === response.totalCount) {
              limitReachedMessage.show();
              setTimeout(function () {
    location.reload();
  });
            } else {
              limitReachedMessage.hide();
            }

            // You can also update other elements on the page as needed
            // ...
          } else {
            console.error('Error in updating quantity:', response.error);
          }
        },
        error: (xhr, status, error) => {
          console.error('AJAX error:', error);
        }
      });
    }
  });
</script>

  
  
  

  







  <%- include('../layouts/footer.ejs') %>